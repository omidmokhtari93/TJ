<div class="sans container p-4"><ul class="rtl nav nav-tabs" id=myTab role=tablist><li class=nav-item><a aria-controls=home aria-selected=true class="active nav-link" data-toggle=tab href=#home id=home-tab role=tab>ثبت</a><li class="mr-3 pointer" style=align-self:center><a onclick=logout()>خروج</a></ul><div class=tab-content id=myTabContent><div class="active fade show tab-pane" role=tabpanel aria-labelledby=home-tab><div id=home><div class="rtl text-right row"><div class=col-sm-6><div class=mt-1>زمان ورود معامله</div><input id=enterdate class="form-control ltr text-center" required readonly style=font-family:arial></div><div class=col-sm-6><div class=mt-1>زمان خروج از معامله</div><input id=closedate class="form-control ltr text-center" readonly style=font-family:arial></div></div><div class="rtl text-right row"><div class=col-sm-4><div class=mt-1>نماد</div><select class="form-control ltr" id=symbol required><option>DOWJONES<option>GOLD<option>EURUSD<option>USDJPY<option>GBPUSD<option>USDCAD<option>USDCHF<option>CADCHF<option>CADJPY<option>CHFJPY<option>EURCHF<option>EURCAD<option>EURGBP<option>EURJPY<option>GBPCAD<option>AUDUSD<option>NZDUSD</select></div><div class=col-sm-4><div class=mt-1>حجم معامله (Lot)</div><input id=volume class="form-control ltr text-center" required type=number></div><div class=col-sm-4><div class=mt-1>سود / ضرر ($)</div><input id=profit class="form-control ltr text-center" required type=number></div></div><div class="rtl text-right row"><div class=col-sm-4><div class=mt-1>دلایل ورود به معامله</div><textarea class="form-control no-resize" id=tradereason rows=3></textarea></div><div class=col-sm-4><div class=mt-1>حالت روانی ورود به معامله</div><textarea class="form-control no-resize" id=enterravani rows=3></textarea></div><div class=col-sm-4><div class=mt-1>حالت روانی خروج از معامله</div><textarea class="form-control no-resize" id=closeravani rows=3></textarea></div></div><div class="rtl text-right row"><div class=col-sm-6><div class=mt-1>اشتباهات</div><textarea class="form-control no-resize" id=mistakes rows=3></textarea></div><div class=col-sm-6><div class=mt-1>توضیحات</div><textarea class="form-control no-resize" id=comment rows=3></textarea></div></div><div class="rtl text-right row"><div class=col-sm-6><input id=file class=mt-3 type=file></div><div class="col-sm-6 text-left"><button class="btn btn-primary mt-3" id=sabt>ثبت</button> <button class="btn mt-3 btn-danger" onclick='EditJournal($("#home").attr("journal-id"))' id=edit style=display:none>ویرایش</button> <button class="btn mt-3 btn-success" onclick=CancelEdit() id=cancel style=display:none>انصراف</button></div></div></div><hr><div class="rtl text-right row mt-2" id=FilterArea><div class=col-sm-5><input id=filterStartDate class="mt-1 form-control ltr text-center" required readonly style=font-family:arial></div><div class=col-sm-5><input id=filterEndDate class="mt-1 form-control ltr text-center" required readonly style=font-family:arial></div><div class=col-sm-2><button class="mt-1 btn btn-block btn-primary" onclick=filterTable()>فیلتر</button></div></div><div class=table-responsive><table class="mt-3 table table-bordered table-hover" id=tablejournals></table></div></div></div></div><div class="fade modal sans" id=modalAddImage role=dialog tabindex=-1><div class="modal-dialog modal-lg"><div class="rtl text-right modal-content"><div class=card><div class=card-header>افزودن عکس</div><div class=card-body><div>انتخاب فایل تصویر</div><input id=changeImageInput type=file></div><div class="text-left card-footer"><button class="btn btn-primary" onclick='addImageToJournal($("#modalAddImage").attr("image-id"))' type=button>ثبت</button></div></div></div></div></div>
<script>$(function(){$("#enterdate , #closedate").datetimepicker({format:"yyyy-mm-dd hh:ii"}),$("#filterStartDate , #filterEndDate").datetimepicker({format:"yyyy-mm-dd hh:ii"})});const getJournals=()=>{AjaxCall({url:"api.asmx/GetJournals",param:{id:-1,startDate:-1,endDate:-1},func:e=>{var a=JSON.parse(e.d);null!=a.type?RedAlert("n",a.message):CreateJournalTable(a)}})},CreateJournalTable=e=>{const a=[];a.push("<tr><th>ردیف</th><th>نماد</th><th>زمان ورود به معامله</th><th>زمان خروج از معامله</th><th>حجم معاملاتی</th><th>سود / ضرر</th><th></th><th></th><th></th></tr>"),e.map((e,t)=>{a.push("<tr><td>"+(t+1)+"</td><td>"+e.Symbol+"</td><td>"+e.EnterDate+"</td><td>"+e.CloseDate+"</td><td>"+e.Volume+"</td><td>"+e.Profit+"</td><td>"+(""==e.FilePath?'<span id="'+e.Id+'">افزودن عکس</span>':'<img src="'+e.FilePath+'"/>')+'</td><td><span id="'+e.Id+'">نمایش جزئیات</span></td><td><span id="'+e.Id+'">ویرایش</span></td></tr>')}),$("#tablejournals").empty().append(a.join(""))};getJournals(),$("#sabt").on("click",function(){if(CheckRequiredFields("home"))return void RedAlert("n","لطفا فیلد خالی را تکمیل نمایید");const e=new FormData,a={EnterDate:$("#enterdate").val(),CloseDate:$("#closedate").val(),Symbol:$("#symbol").val(),Volume:$("#volume").val(),Profit:$("#profit").val(),TradeReason:$("#tradereason").val(),EnterRavani:$("#enterravani").val(),CloseRavani:$("#closeravani").val(),Mistakes:$("#mistakes").val(),Comment:$("#comment").val()};e.append("file",$("#file")[0].files[0]),e.append("data",JSON.stringify(a)),$.ajax({url:"api.asmx/Sabt",data:e,type:"POST",processData:!1,contentType:!1,complete:e=>{var a=JSON.parse(e.responseXML.documentElement.innerHTML);"success"==a.type?(GreenAlert("n",a.message),ClearFields("home"),getJournals()):RedAlert("n",a.message)},error:()=>{RedAlert("n","خطا در برقراری ارتباط")}})}),$("table").on("click","tr td span",function(){switch($(this).parent().index()){case 8:editJournalActive(this.id);break;case 7:AjaxCall({url:"api.asmx/GetJournals",param:{id:this.id,startDate:-1,endDate:-1},func:e=>{var a=JSON.parse(e.d);AppendModal(a[0])}});break;case 6:$("#modalAddImage").attr("image-id",this.id),$("#modalAddImage").modal("show")}});const AppendModal=e=>{var a='<div class="modal fade sans" data-backdrop="static" tabindex="-1" role="dialog" id="detailmodal"> <div class="modal-dialog modal-lg"> <div class="modal-content"> <img style="width: 100%; height: auto;" src="'+e.FilePath+'" /> <div class="card-body rtl text-right"> <p>زمان رود به معامله : '+e.EnterDate+"</p> <p>زمان خروج از معامله : "+e.CloseDate+"</p> <p>نماد : "+e.Symbol+"</p> <p>حجم معاملاتی : "+e.Volume+"</p> <p>سود / ضرر : "+e.Profit+"</p> <p>دلایل ورود به معامله : "+e.TradeReason+"</p> <p>حالت روانی ورود به معامله : "+e.EnterRavani+"</p> <p>حالت روانی خروج از معامله : "+e.CloseRavani+"</p> <p>اشتباهات : "+e.Mistakes+"</p> <p>توضیحات : "+e.Comment+'</p> <div class="text-left"> <button class="btn btn-danger" onclick="removeModal()">بستن</button> </div> </div> </div> </div> </div>';$("body").append(a),$("#detailmodal").modal("show")},removeModal=()=>{$("#detailmodal").modal("hide"),setTimeout(()=>{$("#detailmodal").remove()},500)},addImageToJournal=e=>{var a=new FormData;a.append("image",$("#changeImageInput")[0].files[0]),a.append("image-id",e),$.ajax({url:"api.asmx/AddJournalImage",data:a,type:"POST",processData:!1,contentType:!1,complete:e=>{console.log(e),GreenAlert("n","تصویر با موفقیت ثبت شد"),$("#modalAddImage").modal("hide"),getJournals()},error:()=>{RedAlert("n","خطا در برقراری ارتباط")}})},editJournalActive=e=>{AjaxCall({url:"api.asmx/GetJournals",param:{id:e,startDate:-1,endDate:-1},func:a=>{var t=JSON.parse(a.d)[0];$("#enterdate").val(t.EnterDate),$("#closedate").val(t.CloseDate),$("#symbol").val(t.Symbol),$("#volume").val(t.Volume),$("#profit").val(t.Profit),$("#tradereason").val(t.TradeReason),$("#enterravani").val(t.EnterRavani),$("#closeravani").val(t.CloseRavani),$("#mistakes").val(t.Mistakes),$("#comment").val(t.Comment),$('<a href="'+t.FilePath+'" target="_blank" id="tasvir">تصویر</a>').insertBefore("#file"),$("#edit").show(),$("#cancel").show(),$("#sabt").hide(),$("#home").attr("journal-id",e)}})},EditJournal=e=>{if(CheckRequiredFields("home"))return void RedAlert("n","لطفا فیلد خالی را تکمیل نمایید");const a=new FormData,t={Id:e,EnterDate:$("#enterdate").val(),CloseDate:$("#closedate").val(),Symbol:$("#symbol").val(),Volume:$("#volume").val(),Profit:$("#profit").val(),TradeReason:$("#tradereason").val(),EnterRavani:$("#enterravani").val(),CloseRavani:$("#closeravani").val(),Mistakes:$("#mistakes").val(),Comment:$("#comment").val()};a.append("file",$("#file")[0].files[0]),a.append("data",JSON.stringify(t)),$.ajax({url:"api.asmx/EditJournal",data:a,type:"POST",processData:!1,contentType:!1,complete:e=>{var a=JSON.parse(e.responseXML.documentElement.innerHTML);"success"==a.type?(GreenAlert("n",a.message),CancelEdit(),getJournals()):RedAlert("n",a.message)},error:()=>{RedAlert("n","خطا در برقراری ارتباط")}})},CancelEdit=()=>{ClearFields("home"),$("#edit").hide(),$("#cancel").hide(),$("#sabt").show(),$("#tasvir").remove()},filterTable=()=>{CheckRequiredFields("FilterArea")?RedAlert("n","لطفا هر دو فیلد را کامل کنید"):AjaxCall({url:"api.asmx/GetJournals",param:{id:-1,startDate:$("#filterStartDate").val(),endDate:$("#filterEndDate").val()},func:e=>{var a=JSON.parse(e.d);CreateJournalTable(a)}})},logout=()=>{AjaxCall({url:"api.asmx/Logout",param:{},func:()=>{location.reload()}})};</script>