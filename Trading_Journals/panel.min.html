<div class="sans container p-4"><ul class="rtl nav nav-tabs" id=myTab role=tablist><li class=nav-item><a aria-controls=home aria-selected=true class="active nav-link" data-toggle=tab href=#home id=home-tab role=tab>ثبت</a><li class="mr-3 pointer" style=align-self:center><a onclick=logout()>خروج</a></ul><div class=tab-content id=myTabContent><div class="active fade show tab-pane" role=tabpanel aria-labelledby=home-tab><div id=home><div class="rtl row text-right"><div class=col-sm-6><div class=mt-1>زمان ورود معامله</div><input class="form-control ltr text-center" id=enterdate required readonly style=font-family:arial></div><div class=col-sm-6><div class=mt-1>زمان خروج از معامله</div><input class="form-control ltr text-center" id=closedate readonly style=font-family:arial></div></div><div class="rtl row text-right"><div class=col-sm-4><div class=mt-1>نماد</div><select class="form-control ltr" id=symbol required><option>DOWJONES<option>GOLD<option>EURUSD<option>USDJPY<option>GBPUSD<option>USDCAD<option>USDCHF<option>CADCHF<option>CADJPY<option>CHFJPY<option>EURCHF<option>EURCAD<option>EURGBP<option>EURJPY<option>GBPCAD<option>AUDUSD<option>NZDUSD</select></div><div class=col-sm-4><div class=mt-1>حجم معامله (Lot)</div><input class="form-control ltr text-center" id=volume required type=number></div><div class=col-sm-4><div class=mt-1>سود / ضرر ($)</div><input class="form-control ltr text-center" id=profit required type=number></div></div><div class="rtl row text-right"><div class=col-sm-4><div class=mt-1>دلایل ورود به معامله</div><textarea class="form-control no-resize" id=tradereason rows=3></textarea></div><div class=col-sm-4><div class=mt-1>حالت روانی ورود به معامله</div><textarea class="form-control no-resize" id=enterravani rows=3></textarea></div><div class=col-sm-4><div class=mt-1>حالت روانی خروج از معامله</div><textarea class="form-control no-resize" id=closeravani rows=3></textarea></div></div><div class="rtl row text-right"><div class=col-sm-6><div class=mt-1>اشتباهات</div><textarea class="form-control no-resize" id=mistakes rows=3></textarea></div><div class=col-sm-6><div class=mt-1>توضیحات</div><textarea class="form-control no-resize" id=comment rows=3></textarea></div></div><div class="rtl row text-right"><div class=col-sm-6><input class=mt-3 id=file type=file></div><div class="col-sm-6 pt-3 text-left"><div class="loading ml-2 spinner-border" role=status style=vertical-align:middle!important;display:none><span class=sr-only>Loading...</span></div><button class="btn btn-primary" id=sabt>ثبت</button> <button class="btn btn-danger" id=edit onclick='EditJournal($("#home").attr("journal-id"))' style=display:none>ویرایش</button> <button class="btn btn-success" id=cancel onclick=CancelEdit() style=display:none>انصراف</button></div></div></div><hr><div class="rtl row text-right mt-2" id=FilterArea><div class=col-sm-5><input class="mt-1 form-control ltr text-center" id=filterStartDate required readonly style=font-family:arial></div><div class=col-sm-5><input class="mt-1 form-control ltr text-center" id=filterEndDate required readonly style=font-family:arial></div><div class=col-sm-2><button class="mt-1 btn btn-block btn-primary" onclick=filterTable()>فیلتر</button></div></div><div class=table-responsive><table class="mt-3 table table-bordered table-hover" id=tablejournals></table></div></div></div></div><div class="fade modal sans" id=detailmodal data-backdrop=static role=dialog tabindex=-1><div class="modal-dialog modal-lg"><div class=modal-content></div></div></div>
<script>$(function () { $("#enterdate , #closedate").datetimepicker({ format: "yyyy-mm-dd hh:ii" }), $("#filterStartDate , #filterEndDate").datetimepicker({ format: "yyyy-mm-dd hh:ii" }) }); const getJournals = () => { AjaxCall({ url: "api.asmx/GetJournals", param: { id: -1, startDate: -1, endDate: -1 }, func: a => { var e = JSON.parse(a.d); null != e.type ? RedAlert("n", e.message) : CreateJournalTable(e) } }) }, CreateJournalTable = a => { const e = []; e.push("<tr><th>ردیف</th><th>نماد</th><th>زمان ورود به معامله</th><th>زمان خروج از معامله</th><th>حجم معاملاتی</th><th>سود / ضرر</th><th>تصویر</th><th></th><th></th></tr>"), a.map((a, t) => { e.push("<tr><td>" + (t + 1) + "</td><td>" + a.Symbol + "</td><td>" + a.EnterDate + "</td><td>" + a.CloseDate + "</td><td>" + a.Volume + "</td><td>" + a.Profit + "</td><td>" + ("" == a.FilePath ? "ندارد" : "دارد") + '</td><td><span id="' + a.Id + '">نمایش جزئیات</span></td><td><span id="' + a.Id + '">ویرایش</span></td></tr>') }), $("#tablejournals").empty().append(e.join("")), $(".loading").hide() }; getJournals(), $("#sabt").on("click", function () { if (CheckRequiredFields("home")) return void RedAlert("n", "لطفا فیلد خالی را تکمیل نمایید"); $(".loading").show(); const a = new FormData, e = { EnterDate: $("#enterdate").val(), CloseDate: $("#closedate").val(), Symbol: $("#symbol").val(), Volume: $("#volume").val(), Profit: $("#profit").val(), TradeReason: $("#tradereason").val(), EnterRavani: $("#enterravani").val(), CloseRavani: $("#closeravani").val(), Mistakes: $("#mistakes").val(), Comment: $("#comment").val() }; a.append("file", $("#file")[0].files[0]), a.append("data", JSON.stringify(e)), $.ajax({ url: "api.asmx/Sabt", data: a, type: "POST", processData: !1, contentType: !1, complete: a => { var e = JSON.parse(a.responseXML.documentElement.innerHTML); "success" == e.type ? (GreenAlert("n", e.message), ClearFields("home"), getJournals(), $(".loading").hide()) : RedAlert("n", e.message) }, error: () => { RedAlert("n", "خطا در برقراری ارتباط") } }) }), $("table").on("click", "tr td span", function () { switch ($(this).parent().index()) { case 8: editJournalActive(this.id); break; case 7: AjaxCall({ url: "api.asmx/GetJournals", param: { id: this.id, startDate: -1, endDate: -1 }, func: a => { var e = JSON.parse(a.d); AppendModal(e[0]) } }) } }); const AppendModal = a => { var e = '<img style="width: 100%; height: auto;" src="' + a.FilePath + '" /> <div class="card-body rtl text-right"> <p><span class="badge badge-primary">زمان رود به معامله : </span> ' + a.EnterDate + '</p> <p><span class="badge badge-primary">زمان خروج از معامله : </span> ' + a.CloseDate + '</p> <p><span class="badge badge-primary">نماد : </span> ' + a.Symbol + '</p> <p><span class="badge badge-primary">حجم معاملاتی : </span> ' + a.Volume + '</p> <p><span class="badge badge-primary">سود / ضرر : </span> ' + a.Profit + '</p> <p><span class="badge badge-primary">دلایل ورود به معامله : </span> ' + a.TradeReason + '</p> <p><span class="badge badge-primary">حالت روانی ورود به معامله : </span> ' + a.EnterRavani + '</p> <p><span class="badge badge-primary">حالت روانی خروج از معامله : </span> ' + a.CloseRavani + '</p> <p><span class="badge badge-primary">اشتباهات : </span> ' + a.Mistakes + '</p> <p><span class="badge badge-primary">توضیحات : </span> ' + a.Comment + '</p> <div class="text-left"> <button class="btn btn-danger" onclick="$(\'#detailmodal\').modal(\'hide\')">بستن</button> </div></div>'; $("#detailmodal").find(".modal-content").empty().append(e), $("#detailmodal").modal("show") }, editJournalActive = a => { AjaxCall({ url: "api.asmx/GetJournals", param: { id: a, startDate: -1, endDate: -1 }, func: e => { var t = JSON.parse(e.d)[0]; $("#enterdate").val(t.EnterDate), $("#closedate").val(t.CloseDate), $("#symbol").val(t.Symbol), $("#volume").val(t.Volume), $("#profit").val(t.Profit), $("#tradereason").val(t.TradeReason), $("#enterravani").val(t.EnterRavani), $("#closeravani").val(t.CloseRavani), $("#mistakes").val(t.Mistakes), $("#comment").val(t.Comment), $('<a href="' + t.FilePath + '" target="_blank" id="tasvir">تصویر</a>').insertBefore("#file"), $("#edit").show(), $("#cancel").show(), $("#sabt").hide(), $("#home").attr("journal-id", a) } }) }, EditJournal = a => { if (CheckRequiredFields("home")) return void RedAlert("n", "لطفا فیلد خالی را تکمیل نمایید"); $(".loading").show(); const e = new FormData, t = { Id: a, EnterDate: $("#enterdate").val(), CloseDate: $("#closedate").val(), Symbol: $("#symbol").val(), Volume: $("#volume").val(), Profit: $("#profit").val(), TradeReason: $("#tradereason").val(), EnterRavani: $("#enterravani").val(), CloseRavani: $("#closeravani").val(), Mistakes: $("#mistakes").val(), Comment: $("#comment").val() }; e.append("file", $("#file")[0].files[0]), e.append("data", JSON.stringify(t)), $.ajax({ url: "api.asmx/EditJournal", data: e, type: "POST", processData: !1, contentType: !1, complete: a => { var e = JSON.parse(a.responseXML.documentElement.innerHTML); "success" == e.type ? (GreenAlert("n", e.message), CancelEdit(), getJournals(), $(".loading").hide()) : RedAlert("n", e.message) }, error: () => { RedAlert("n", "خطا در برقراری ارتباط") } }) }, CancelEdit = () => { ClearFields("home"), $("#edit").hide(), $("#cancel").hide(), $("#sabt").show(), $("#tasvir").remove() }, filterTable = () => { CheckRequiredFields("FilterArea") ? RedAlert("n", "لطفا هر دو فیلد را کامل کنید") : ($(".loading").show(), AjaxCall({ url: "api.asmx/GetJournals", param: { id: -1, startDate: $("#filterStartDate").val(), endDate: $("#filterEndDate").val() }, func: a => { var e = JSON.parse(a.d); CreateJournalTable(e) } })) }, logout = () => { AjaxCall({ url: "api.asmx/Logout", param: {}, func: () => { location.reload() } }) };</script>